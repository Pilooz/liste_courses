<div fxLayout="column" fxLayoutGap="30px" class="elderly-profile">
  <h2 fxFlexAlign="center">{{elderly.firstname}} {{elderly.lastname | uppercase}}</h2>

  <div fxLayout="column" class="sections">
    <div fxLayout="column" class="section">
      <span class="section-title">Profil</span>
      <mat-accordion>
        <!-- Identity -->
        <ng-container [ngTemplateOutlet]="panel" [ngTemplateOutletContext]="{expanded: showIdentity, title: 'Carte d\'identité', content: identity, editPage: 'edit'}"></ng-container>
        <!-- Prefered food -->
        <ng-container [ngTemplateOutlet]="panel" [ngTemplateOutletContext]="{expanded: showFood, title: 'Préférences alimentaires', content: food, editPage: 'food'}"></ng-container>
        <!-- Skills section -->
        <ng-container [ngTemplateOutlet]="panel" [ngTemplateOutletContext]="{expanded: showSkills, title: 'Compétences culinaires', content: skills, editPage: 'skills'}"></ng-container>

        <!-- Panel template -->
        <ng-template #panel let-expanded="expanded" let-title="title" let-content="content" let-editPage="editPage">
          <mat-expansion-panel [expanded]="expanded">
            <mat-expansion-panel-header>
              <mat-panel-title>{{title}}</mat-panel-title>
            </mat-expansion-panel-header>
            <div fxLayout="row" class="section-content">
              <div fxFlex fxLayout="column">
                <ng-container [ngTemplateOutlet]="content" [ngTemplateOutletContext]="{elderly: elderly}"></ng-container>
              </div>
              <a [routerLink]="['/elderly', elderly.id, editPage]" [queryParams]="{standalone: true}">
                <button mat-button type="button">
                  <mat-icon>edit</mat-icon>
                  Modifier
                </button>
              </a>
            </div>
          </mat-expansion-panel>
        </ng-template>
      </mat-accordion>
    </div>
    <div fxLayout="column" class="section">
      <span class="section-title">Semaine du {{startDate | date:'dd/MM/yyyy'}} au {{startDate | date:'dd/MM/yyyy'}}</span>
      <div fxLayoutAlign="center center" class="background-blue-light">
        <a [routerLink]="['/elderly', elderly.id, 'meals-calendar']">
          <button class="background-blue" mat-button type="button">Planifier la semaine</button>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Identity template, to be injected in panel  -->
<ng-template #identity let-elderly="elderly">
  <span>
    <strong>{{elderly.firstname}} {{elderly.lastname | uppercase}}</strong>
  </span>
  <span>Né(e) le {{(elderly.birthdate | date:'dd MMMM yyyy') || '??'}} ({{(elderly.birthdate | dateDiff:'':'years') || '??'}} ans)
  </span>
  <span>{{elderly.address}}</span>
  <span>{{elderly.postalCode}} {{elderly.city}}</span>
  <span>{{elderly.phone}}</span>
</ng-template>

<!-- Food template, to be injected in panel -->
<ng-template #food let-elderly="elderly">
  <span>
    <strong>Allergies :</strong> {{elderly.allergies}}
  </span>
  <span>
    <strong>Restrictions alimentaires :</strong> {{elderly.restrictions}}
  </span>
  <span>
    <strong>Adore :</strong> {{elderly.likes}}
  </span>
  <span>
    <strong>Déteste :</strong> {{elderly.dislikes}}
  </span>
  <span>
    <strong>Habitudes de repas :</strong> {{elderly.habits}}
  </span>
</ng-template>

<ng-template #skills let-elderly="elderly">
  <span>
    <strong>{{elderly.firstname}} peut :</strong>
  </span>
  <div fxLayout="row wrap" fxLayoutGap="10px">
    <span *ngFor="let skill of elderly.skills" class="elderly-skill">{{skill.label}}</span>
  </div>
</ng-template>